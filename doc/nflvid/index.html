<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>		<html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>		<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">

      <title>nflvid API documentation</title>
      <meta name="description" content="A simple library to download, slice and search NFL game footage on a
play-by-play basis.

This libra...">

  
  <style type="text/css">
  
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    background: #ddd;
    height: 100%;
  }

  #container {
    width: 840px;
    background-color: #fdfdfd;
    color: #111;
    margin: 0 auto;
    border-left: 1px solid #000;
    border-right: 1px solid #000;
    padding: 10px 25px;
    min-height: 100%;
  }

  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    top: 5px;
    left: 5px;
    font-size: 140%;
  }

  h1 {
    margin: 0 0 10px 0;
  }

  h2 {
    margin: 25px 0 10px 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
  }

  a:hover {
    color: #e08524;
  }

  p {
    line-height: 1.35em;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .ident {
    color: #900;
  }

  code {
    background: #e8e8e8;
  } 

  pre {
    background: #e8e8e8;
    padding: 6px;
    margin: 0 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }

  ul#index {
    padding: 0;
    margin: 0;
  }

    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }

    ul#index li {
      margin-bottom: 18px;
    }

      ul#index ul li {
        margin-bottom: 8px;
      }

    ul#index, ul#index ul {
      list-style-type: none;
    }

    ul#index ul {
      margin: 0 0 10px 20px;
      padding: 0;
    }

  .column_list {
    width: 100%;
    display: inline-block;
    margin-left: 20px;
  }

  .column_list:after {
    visibility: hidden;
    display: block;
    font-size: 0;
    height: 0;
    content: " ";
    clear: both;
  }

    .column_list ul {
      float: left;
      text-align: left;
      width: 32%;
      margin: 0 !important;
    }

  .item {
    margin: 0 0 25px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #e8e8e8;
      padding: 4px;
      margin: 0 0 8px 0;
      font-size: 110%;
      font-weight: bold;
    }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 10px 0;
      padding: 0 8px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 10px 8px 0 8px;
      padding: 0;
    }

    .source_link {
      font-weight: bold;
    }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }

  /*****************************/

  </style>

    <style type="text/css">
    .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
    function toggle(id, $link) {
      $node = document.getElementById(id);
      if (!$node)
        return;
      if (!$node.style.display || $node.style.display == 'none') {
        $node.style.display = 'block';
        $link.innerHTML = 'Hide source.';
      } else {
        $node.style.display = 'none';
        $link.innerHTML = 'Show source.';
      }
    }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">

    
  

  


  <h1>Module nflvid</h1>
  <p>A simple library to download, slice and search NFL game footage on a
play-by-play basis.</p>
<p>This library comes with preloaded play-by-play meta data, which
describes the start time of each play in the game footage. However,
the actual footage does not come with this library and is not released
by me. This package therefore provides utilities to batch download NFL
Game Footage from the original source.</p>
<p>Once game footage is downloaded, you can use this library to search
plays and construct a playlist to play in any video player.</p>
  
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid', this);">Show source.</a></p>
    <div id="source-nflvid" class="source">
      <div class="codehilite"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A simple library to download, slice and search NFL game footage on a</span>
<span class="sd">play-by-play basis.</span>

<span class="sd">This library comes with preloaded play-by-play meta data, which</span>
<span class="sd">describes the start time of each play in the game footage. However,</span>
<span class="sd">the actual footage does not come with this library and is not released</span>
<span class="sd">by me. This package therefore provides utilities to batch download NFL</span>
<span class="sd">Game Footage from the original source.</span>

<span class="sd">Once game footage is downloaded, you can use this library to search</span>
<span class="sd">plays and construct a playlist to play in any video player.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">path</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="kn">import</span> <span class="nn">bs4</span>

<span class="kn">import</span> <span class="nn">eventlet</span>
<span class="n">_httplib2</span> <span class="o">=</span> <span class="n">eventlet</span><span class="o">.</span><span class="n">import_patched</span><span class="p">(</span><span class="s">&#39;httplib2&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">eventlet.green.subprocess</span> <span class="kn">as</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">nflgame</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="n">__pdoc__</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">__broadcast_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># game eid -&gt; play id -&gt; Play</span>
<span class="n">__coach_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># game eid -&gt; play id -&gt; Play</span>

<span class="n">_xmlf</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;pbp-xml&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">.xml.gz&#39;</span><span class="p">)</span>
<span class="n">_xml_base_url</span> <span class="o">=</span> <span class="s">&#39;http://e2.cdnl3.neulion.com/nfl/edl/nflgr/</span><span class="si">%d</span><span class="s">/</span><span class="si">%s</span><span class="s">.xml&#39;</span>
<span class="n">_coach_url</span> <span class="o">=</span> <span class="s">&#39;rtmp://neulionms.fcod.llnwd.net/a5306/e1/mp4:&#39;</span> \
             <span class="s">&#39;u/nfl/nfl/coachtapes/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_all_1600&#39;</span>
<span class="n">_coach_url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;rtmp://neulionms.fcod.llnwd.net&#39;</span><span class="p">,</span>
    <span class="s">&#39;a5306/e1&#39;</span><span class="p">,</span>
    <span class="s">&#39;mp4:u/nfl/nfl/coachtapes/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_all_1600&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_broadcast_url</span> <span class="o">=</span> <span class="s">&#39;http://nlds82.cdnl3nl.neulion.com/nlds_vod/nfl/vod/&#39;</span> \
                 <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/2_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_h_whole_1_</span><span class="si">%s</span><span class="s">.mp4.m3u8&#39;</span>


<span class="k">def</span> <span class="nf">_eprint</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">broadcast_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="s">&#39;1600&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the HTTP Live Stream URL (an m3u8 file) for the given game</span>
<span class="sd">    and quality.</span>

<span class="sd">    Note that this does not work with every game (yet). In particular,</span>
<span class="sd">    URLs vary unpredictably (to me) from game to game.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_broadcast_url</span> \
        <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">,</span>
           <span class="n">gobj</span><span class="o">.</span><span class="n">away</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">home</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">quality</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">coach_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the rtmp URL as a triple for the coach footage of the given</span>
<span class="sd">    game. The elements of the triple are:</span>

<span class="sd">        (rtmp server, rtmp app name, rtmp playpath)</span>

<span class="sd">    Coach video only comes in 1600 quality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">footage_full</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the path to the full video for a given game inside an</span>
<span class="sd">    nflvid footage directory.</span>

<span class="sd">    If the full footage doesn&#39;t exist, then None is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">fp</span>


<span class="k">def</span> <span class="nf">footage_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all footage broken down by play inside an nflvid</span>
<span class="sd">    footage directory. The list is sorted numerically by play id.</span>

<span class="sd">    If no footage breakdown exists for the game provided, then an empty</span>
<span class="sd">    list is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">footage_play</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">playid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a file path to an existing play slice in the footage play</span>
<span class="sd">    directory for the game and play given.</span>

<span class="sd">    If the file for the play is not readable, then `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamedir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gamedir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">playid</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">fp</span>


<span class="k">def</span> <span class="nf">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">gamekey</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">gamekey</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;(Season: </span><span class="si">%s</span><span class="s">, Week: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> \
           <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;year&#39;</span><span class="p">],</span> <span class="n">gobj</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="s">&#39;week&#39;</span><span class="p">],</span> <span class="n">gobj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unsliced_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scans the game directory inside footage_play_dir and returns a list</span>
<span class="sd">    of plays that haven&#39;t been sliced yet. In particular, a play is</span>
<span class="sd">    only considered sliced if the following file is readable, assuming</span>
<span class="sd">    {playid} is its play id:</span>

<span class="sd">        {footage_play_dir}/{eid}-{gamekey}/{playid}.mp4</span>

<span class="sd">    All plays for the game given that don&#39;t fit this criteria will be</span>
<span class="sd">    returned in the list.</span>

<span class="sd">    If the list is empty, then all plays for the game have been sliced.</span>
<span class="sd">    Alternatively, `None` can be returned if there was a problem</span>
<span class="sd">    retrieving the play-by-play meta data.</span>

<span class="sd">    If `coach` is `False`, then play timings for broadcast footage will</span>
<span class="sd">    be used instead of coach timings.</span>

<span class="sd">    If `dry_run` is `True`, then only the first 10 plays of the game</span>
<span class="sd">    are sliced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="p">)</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>

    <span class="n">unsliced</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">ps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">dry_run</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">idstr</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="n">pid</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="n">unsliced</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unsliced</span>


<span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">threads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses `ffmpeg` to slice the given footage file into play-by-play</span>
<span class="sd">    pieces.  The `full_footage_file` should be a path to a full</span>
<span class="sd">    game downloaded with `nflvid-footage` and `gobj` should be the</span>
<span class="sd">    corresponding `nflgame.game.Game` object.</span>

<span class="sd">    The `footage_play_dir` is where the pieces will be saved:</span>

<span class="sd">        {footage_play_dir}/{eid}-{gamekey}/{playid}.mp4</span>

<span class="sd">    This function will not duplicate work. If a video file exists for</span>
<span class="sd">    a particular play, then slice will not regenerate it.</span>

<span class="sd">    Note that this function uses an `eventlet` green pool to run</span>
<span class="sd">    multiple `ffmpeg` instances simultaneously. The maximum number</span>
<span class="sd">    of threads to use is specified by `threads`. This function only</span>
<span class="sd">    terminates when all threads have finished processing.</span>

<span class="sd">    If `coach` is `False`, then play timings for broadcast footage will</span>
<span class="sd">    be used instead of coach timings.</span>

<span class="sd">    If `dry_run` is `True`, then only the first 10 plays of the game</span>
<span class="sd">    are sliced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

    <span class="n">unsliced</span> <span class="o">=</span> <span class="n">unsliced_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unsliced</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">unsliced</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Only show an annoying error message if there are no sliced</span>
        <span class="c"># plays on disk.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">footage_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
            <span class="n">_eprint</span><span class="p">(</span>
                <span class="s">&#39;There are no unsliced plays remaining for game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">.</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;If they have not been sliced yet, then the XML play-by-play &#39;</span>
                <span class="s">&#39;meta data may not be available or is corrupt.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
        <span class="k">return</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">eventlet</span><span class="o">.</span><span class="n">greenpool</span><span class="o">.</span><span class="n">GreenPool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">unsliced</span><span class="p">:</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">spawn_n</span><span class="p">(</span><span class="n">slice_play</span><span class="p">,</span> <span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span>
                     <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">waitall</span><span class="p">()</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE slicing game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">artificial_slice</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">gobj_play</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a video file that contains a single static image with a</span>
<span class="sd">    textual description of the play. The purpose is to provide some</span>
<span class="sd">    representation of a play even if its video form doesn&#39;t exist. (Or</span>
<span class="sd">    more likely, the play-by-play meta data for that play is corrupt.)</span>

<span class="sd">    This function requires the use of ImageMagick&#39;s `convert` with</span>
<span class="sd">    pango support.</span>

<span class="sd">    Note that `gobj_play` is an `nflgame.game.Play` object and not a</span>
<span class="sd">    `nflvid.Play` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">gobj_play</span><span class="o">.</span><span class="n">playid</span><span class="p">))</span>

    <span class="n">pango</span> <span class="o">=</span> <span class="s">&#39;&lt;span size=&quot;20000&quot; foreground=&quot;white&quot;&gt;&#39;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;.png&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;convert&#39;</span><span class="p">,</span>
               <span class="s">&#39;-size&#39;</span><span class="p">,</span> <span class="s">&#39;640x480&#39;</span><span class="p">,</span>  <span class="c"># size of coach footage. configurable?</span>
               <span class="s">&#39;-background&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">,</span>
               <span class="s">&#39;pango:</span><span class="si">%s%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pango</span><span class="p">,</span> <span class="n">gobj_play</span><span class="p">),</span>
               <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
               <span class="p">]</span>
        <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
               <span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;image2&#39;</span><span class="p">,</span>
               <span class="s">&#39;-loop&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
               <span class="s">&#39;-r:v&#39;</span><span class="p">,</span> <span class="s">&#39;7&#39;</span><span class="p">,</span>
               <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
               <span class="s">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="s">&#39;yuv420p&#39;</span><span class="p">,</span>
               <span class="s">&#39;-an&#39;</span><span class="p">,</span>
               <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;10&#39;</span><span class="p">,</span>
               <span class="n">outpath</span><span class="p">,</span>
               <span class="p">]</span>
        <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">slice_play</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">play</span><span class="p">,</span>
               <span class="n">max_duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cut_scoreboard</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is just like `nflvid.slice`, but it only slices the play</span>
<span class="sd">    provided.  In typical cases, `nflvid.slice` should be used since it</span>
<span class="sd">    makes sure not to duplicate work.</span>

<span class="sd">    This function will not check if the play-by-play directory for</span>
<span class="sd">    `gobj` has been created.</span>

<span class="sd">    `max_duration` is used to cap the length of a play. This</span>
<span class="sd">    drastically cuts down on the storage requirements of a game at the</span>
<span class="sd">    cost of potentially missing longer plays. This is particularly</span>
<span class="sd">    useful if you are slicing broadcast footage, where imposing a cap</span>
<span class="sd">    at about 15 seconds can decrease storage requirements by more than</span>
<span class="sd">    half without missing much.</span>

<span class="sd">    When `cut_scoreboard` is `True`, the first 3.0 seconds of the play</span>
<span class="sd">    will be clipped to remove the scoreboard view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">start</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="n">play</span><span class="o">.</span><span class="n">idstr</span><span class="p">())</span>

    <span class="n">et</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">end</span>
    <span class="k">if</span> <span class="n">et</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># Probably the last play of the game.</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">et</span><span class="o">.</span><span class="n">seconds</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="o">.</span><span class="n">seconds</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">max_duration</span><span class="p">:</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="n">max_duration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cut_scoreboard</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="n">dr</span> <span class="o">=</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">et</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="o">.</span><span class="n">fractional</span><span class="p">())</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">milli</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">milli</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
           <span class="s">&#39;-ss&#39;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span>
           <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span>
           <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span>
           <span class="s">&#39;-acodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
           <span class="s">&#39;-vcodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
           <span class="n">outpath</span><span class="p">,</span>
           <span class="p">]</span>
    <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">download_broadcast</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="s">&#39;1600&#39;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts an `ffmpeg` process to download the full broadcast of the</span>
<span class="sd">    given game with the quality provided. The qualities available are:</span>
<span class="sd">    400, 800, 1200, 1600, 2400, 3000, 4500 with 4500 being the best.</span>

<span class="sd">    The footage will be saved to the following path:</span>

<span class="sd">        footage_dir/{eid}-{gamekey}.mp4</span>

<span class="sd">    If footage is already at that path, then an</span>
<span class="sd">    `exceptions.LookupError` is raised.</span>

<span class="sd">    A full game&#39;s worth of broadcast footage at a quality of 1600 is</span>
<span class="sd">    about **2GB**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;Footage path &quot;</span><span class="si">%s</span><span class="s">&quot; already exists.&#39;</span> <span class="o">%</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">broadcast_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

    <span class="c"># Let&#39;s check to see if the URL exists. We could let ffmpeg catch</span>
    <span class="c"># the error, but since this is a common error, let&#39;s show something</span>
    <span class="c"># nicer than a bunch of ffmpeg vomit.</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_httplib2</span><span class="o">.</span><span class="n">Http</span><span class="p">()</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&#39;HEAD&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;200&#39;</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;BAD URL (http status </span><span class="si">%s</span><span class="s">) for game </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">],</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">),</span> <span class="n">url</span><span class="p">))</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
           <span class="s">&#39;-timeout&#39;</span><span class="p">,</span> <span class="s">&#39;60&#39;</span><span class="p">,</span>
           <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;30&#39;</span><span class="p">]</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-absf&#39;</span><span class="p">,</span> <span class="s">&#39;aac_adtstoasc&#39;</span><span class="p">,</span>  <span class="c"># no idea. ffmpeg says I need it though.</span>
            <span class="s">&#39;-acodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
            <span class="s">&#39;-vcodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
            <span class="n">fp</span><span class="p">,</span>
            <span class="p">]</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Downloading game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">download_coach</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts an `rtmpdump` process to download the full coach footage of</span>
<span class="sd">    the given game. Currently, the only quality available is 1600.</span>

<span class="sd">    The footage will be saved to the following path:</span>

<span class="sd">        footage_dir/{eid}-{gamekey}.mp4</span>

<span class="sd">    If footage is already at that path, then an</span>
<span class="sd">    `exceptions.LookupError` is raised.</span>

<span class="sd">    A full game&#39;s worth of footage at a quality of 1600 is about</span>
<span class="sd">    **1GB**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;Footage path &quot;</span><span class="si">%s</span><span class="s">&quot; already exists.&#39;</span> <span class="o">%</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">server</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">coach_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">)</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;rtmpdump&#39;</span><span class="p">,</span>
           <span class="s">&#39;--rtmp&#39;</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span>
           <span class="s">&#39;--app&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span>
           <span class="s">&#39;--playpath&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
           <span class="s">&#39;--timeout&#39;</span><span class="p">,</span> <span class="s">&#39;60&#39;</span><span class="p">,</span>
           <span class="p">]</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--stop&#39;</span><span class="p">,</span> <span class="s">&#39;30&#39;</span><span class="p">]</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">fp</span><span class="p">]</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Downloading game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE (incomplete) with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
            <span class="n">err</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
            <span class="k">raise</span> <span class="n">err</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="c"># A hack for rtmpdump...</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rtmpdump&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="s">&#39;   </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)))</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&quot;Could not run &#39;</span><span class="si">%s</span><span class="s">&#39; (exit code </span><span class="si">%d</span><span class="s">):</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">indent</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">output</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&quot;Could not run &#39;</span><span class="si">%s</span><span class="s">&#39; (errno: </span><span class="si">%d</span><span class="s">): </span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an ordered dictionary of all plays for a particular game</span>
<span class="sd">    with timings for the coach footage. If `coach` is `False`, then the</span>
<span class="sd">    timings will be for the broadcast footage.</span>

<span class="sd">    The game `gobj` must be an `nflgame.game.Game` object.</span>

<span class="sd">    If there is a problem retrieving the data, `None` is returned.</span>

<span class="sd">    If the game is over, then the XML data is saved to disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coach</span><span class="p">:</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">__coach_cache</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">__broadcast_cache</span>

    <span class="k">if</span> <span class="n">gobj</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span>

    <span class="n">rawxml</span> <span class="o">=</span> <span class="n">_get_xml_data</span><span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">)</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">_xml_plays</span><span class="p">(</span><span class="n">rawxml</span><span class="p">,</span> <span class="n">coach</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Could not find timing nodes in XML data, &#39;</span>
                <span class="s">&#39;which provide the start time of each play.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">__broadcast_cache</span><span class="p">[</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps</span>

    <span class="c"># Save the XML data to disk if the game is over.</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_xmlf</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gobj</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">),</span> <span class="n">rawxml</span><span class="p">,</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Could not cache XML data. Please make &#39;</span>
                    <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; writable.&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ps</span>


<span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a `nflvid.Play` object given a game and a play id with</span>
<span class="sd">    timings for the coach footage. If `coach` is `False`, then the</span>
<span class="sd">    timings will be for the broadcast footage.</span>

<span class="sd">    The game `gobj` must be an `nflgame.game.Game` object.</span>

<span class="sd">    If a play with the given id does not exist, `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">playid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Play</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the start and end timings of single play in coach or</span>
<span class="sd">    broadcast footage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">playid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Corresponds to the `ArchiveTCIN` or `CATIN` field in the source</span>
<span class="sd">        data. `ArchiveTCIN` is used for broadcast footage while `CATIN`</span>
<span class="sd">        is used for coach footage.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The end time of the play. This is typically the start time of</span>
<span class="sd">        the next play (from `ArchiveTCIN` or `CATIN`). When the next</span>
<span class="sd">        play isn&#39;t available, this is `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A numeric play identifier that serves as a foreign key from an</span>
<span class="sd">        `nflgame.game.Play` object to a `nflvid.Play` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">idstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string play id padded with zeroes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PlayTime</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a footage time point retrieved from the source XML</span>
<span class="sd">    meta data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;hh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The hour portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;mm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The minutes portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;ss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The seconds portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;milli&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The milliseconds portion of the play time.&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a PlayTime object given a `point` in time in the</span>
<span class="sd">        format `HH:MM:SS:MMM` where `MMM` can be either 2 or 3 digits.</span>

<span class="sd">        Alternatively, `seconds` can be provided (which may be a</span>
<span class="sd">        float).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">milli</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">seconds</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">)))</span>

            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">))</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span>

            <span class="n">seconds</span> <span class="o">-=</span> <span class="n">hh</span> <span class="o">*</span> <span class="mi">3600</span>
            <span class="n">mm</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>

            <span class="n">seconds</span> <span class="o">-=</span> <span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">seconds</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%03d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="n">point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Bad play time format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Expected 4 parts but got </span><span class="si">%d</span><span class="s"> in: </span><span class="si">%s</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">parts</span>

        <span class="c"># I believe milliseconds is given in tens of milliseconds</span>
        <span class="c"># for the ArchiveTCIN node. But the CATIN node (coach timing)</span>
        <span class="c"># provides regular milliseconds.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">*=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">add_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new PlayTime with `seconds` (int or float) added to</span>
<span class="sd">        self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns this time point rounded to the nearest second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">secs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">secs</span>

    <span class="k">def</span> <span class="nf">fractional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns this time point as fractional seconds based on</span>
<span class="sd">        milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">secs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fractional</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the difference rounded to nearest second between two</span>
<span class="sd">        time points.  The `other` time point must take place before the</span>
<span class="sd">        current time point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not &lt;= than </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">fractional</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span>


<span class="k">def</span> <span class="nf">_xml_plays</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses the XML raw string `data` given into an ordered dictionary</span>
<span class="sd">    of `nflvid.Play` objects corresponding to coach play timings. If</span>
<span class="sd">    `coach` is set to `False`, then play timings for the broadcast are</span>
<span class="sd">    retrieved.</span>

<span class="sd">    The dictionary is keyed by play id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="c"># Load everything into a list first, since we need to look ahead to see</span>
    <span class="c"># the next play&#39;s start time to compute the current play&#39;s duration.</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;row&#39;</span><span class="p">):</span>
        <span class="n">playid</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">playid</span><span class="p">:</span>
            <span class="n">playid</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;playid&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">playid</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">coach</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;catin&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;archivetcin&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c"># If this start doesn&#39;t procede the last start time, skip it.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">playid</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>

    <span class="c"># A predicate for determining whether to ignore a row or not in our final</span>
    <span class="c"># result set. For example, timeouts take a lot of time but aren&#39;t needed</span>
    <span class="c"># for play-by-play footage.</span>
    <span class="k">def</span> <span class="nf">ignore</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;playdescription&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;playdescription&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;timeout&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;playdescription&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;two-minute&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="c"># Did we miss anything?</span>
        <span class="k">if</span> <span class="s">&#39;preplaybyplay&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;preplaybyplay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;timeout&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">playid</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ignore</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="n">playid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Play</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">playid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_get_xml_data</span><span class="p">(</span><span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">gamekey</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the XML play data corresponding to the game given. A game</span>
<span class="sd">    must be specified in one of two ways: by providing the `eid` and</span>
<span class="sd">    `gamekey` or by providing the file path `fpath` to a gzipped XML</span>
<span class="sd">    file.</span>

<span class="sd">    If the XML data is already on disk, it is read, decompressed and</span>
<span class="sd">    returned.</span>

<span class="sd">    Otherwise, the XML data is downloaded from the NFL web</span>
<span class="sd">    site. If the data doesn&#39;t exist yet or there was an error,</span>
<span class="sd">    `nflvid._get_xml_data` returns None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">gamekey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">fpath</span> <span class="o">=</span> <span class="n">_xmlf</span> <span class="o">%</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">gamekey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">_xml_base_url</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">gamekey</span><span class="p">)</span>  <span class="c"># The year and the game key.</span>
        <span class="k">return</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre></div>

    </div>

  <hr>

  <h2>Index</h2>

  <ul id="index">

    <li><h4><a href="#header-functions">Functions</a></h4>
      
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#nflvid.artificial_slice">artificial_slice</a></li>
          <li class="mono"><a href="#nflvid.broadcast_url">broadcast_url</a></li>
          <li class="mono"><a href="#nflvid.coach_url">coach_url</a></li>
          <li class="mono"><a href="#nflvid.download_broadcast">download_broadcast</a></li>
          <li class="mono"><a href="#nflvid.download_coach">download_coach</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#nflvid.footage_full">footage_full</a></li>
          <li class="mono"><a href="#nflvid.footage_play">footage_play</a></li>
          <li class="mono"><a href="#nflvid.footage_plays">footage_plays</a></li>
          <li class="mono"><a href="#nflvid.play">play</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#nflvid.plays">plays</a></li>
          <li class="mono"><a href="#nflvid.slice">slice</a></li>
          <li class="mono"><a href="#nflvid.slice_play">slice_play</a></li>
          <li class="mono"><a href="#nflvid.unsliced_plays">unsliced_plays</a></li>
      </ul>
  </div>

    </li>

    <li><h4><a href="#header-classes">Classes</a></h4>
      <ul>
          <li class="mono">
            <span class="class_name"><a href="#nflvid.Play">Play</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#nflvid.Play.__init__">__init__</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#nflvid.Play.idstr">idstr</a></li>
      </ul>
      <ul>
      </ul>
  </div>

          </li>
          <li class="mono">
            <span class="class_name"><a href="#nflvid.PlayTime">PlayTime</a></span>
            
              
  
  <div class="column_list">
      <ul>
          <li class="mono"><a href="#nflvid.PlayTime.__init__">__init__</a></li>
          <li class="mono"><a href="#nflvid.PlayTime.add_seconds">add_seconds</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#nflvid.PlayTime.fractional">fractional</a></li>
      </ul>
      <ul>
          <li class="mono"><a href="#nflvid.PlayTime.seconds">seconds</a></li>
      </ul>
  </div>

          </li>
      </ul>
    </li>

  </ul>


  <h2 id="header-functions">Functions</h2>
      
    <div class="item">
      <div class="name def" id="nflvid.artificial_slice">
        <p>def <span class="ident">artificial_slice</span>(</p><p>footage_play_dir, gobj, gobj_play, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Creates a video file that contains a single static image with a
textual description of the play. The purpose is to provide some
representation of a play even if its video form doesn't exist. (Or
more likely, the play-by-play meta data for that play is corrupt.)</p>
<p>This function requires the use of ImageMagick's <code>convert</code> with
pango support.</p>
<p>Note that <code>gobj_play</code> is an <code>nflgame.game.Play</code> object and not a
<a href="#nflvid.Play"><code>Play</code></a> object.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.artificial_slice', this);">Show source.</a></p>
    <div id="source-nflvid.artificial_slice" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">artificial_slice</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">gobj_play</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a video file that contains a single static image with a</span>
<span class="sd">    textual description of the play. The purpose is to provide some</span>
<span class="sd">    representation of a play even if its video form doesn&#39;t exist. (Or</span>
<span class="sd">    more likely, the play-by-play meta data for that play is corrupt.)</span>

<span class="sd">    This function requires the use of ImageMagick&#39;s `convert` with</span>
<span class="sd">    pango support.</span>

<span class="sd">    Note that `gobj_play` is an `nflgame.game.Play` object and not a</span>
<span class="sd">    `nflvid.Play` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">gobj_play</span><span class="o">.</span><span class="n">playid</span><span class="p">))</span>

    <span class="n">pango</span> <span class="o">=</span> <span class="s">&#39;&lt;span size=&quot;20000&quot; foreground=&quot;white&quot;&gt;&#39;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;w+&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;.png&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;convert&#39;</span><span class="p">,</span>
               <span class="s">&#39;-size&#39;</span><span class="p">,</span> <span class="s">&#39;640x480&#39;</span><span class="p">,</span>  <span class="c"># size of coach footage. configurable?</span>
               <span class="s">&#39;-background&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">,</span>
               <span class="s">&#39;pango:</span><span class="si">%s%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pango</span><span class="p">,</span> <span class="n">gobj_play</span><span class="p">),</span>
               <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
               <span class="p">]</span>
        <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
               <span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;image2&#39;</span><span class="p">,</span>
               <span class="s">&#39;-loop&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
               <span class="s">&#39;-r:v&#39;</span><span class="p">,</span> <span class="s">&#39;7&#39;</span><span class="p">,</span>
               <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
               <span class="s">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="s">&#39;yuv420p&#39;</span><span class="p">,</span>
               <span class="s">&#39;-an&#39;</span><span class="p">,</span>
               <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;10&#39;</span><span class="p">,</span>
               <span class="n">outpath</span><span class="p">,</span>
               <span class="p">]</span>
        <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.broadcast_url">
        <p>def <span class="ident">broadcast_url</span>(</p><p>gobj, quality='1600', **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns the HTTP Live Stream URL (an m3u8 file) for the given game
and quality.</p>
<p>Note that this does not work with every game (yet). In particular,
URLs vary unpredictably (to me) from game to game.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.broadcast_url', this);">Show source.</a></p>
    <div id="source-nflvid.broadcast_url" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">broadcast_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="s">&#39;1600&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the HTTP Live Stream URL (an m3u8 file) for the given game</span>
<span class="sd">    and quality.</span>

<span class="sd">    Note that this does not work with every game (yet). In particular,</span>
<span class="sd">    URLs vary unpredictably (to me) from game to game.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_broadcast_url</span> \
        <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">,</span>
           <span class="n">gobj</span><span class="o">.</span><span class="n">away</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">home</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">quality</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.coach_url">
        <p>def <span class="ident">coach_url</span>(</p><p>gobj, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns the rtmp URL as a triple for the coach footage of the given
game. The elements of the triple are:</p>
<div class="codehilite"><pre><span class="p">(</span><span class="n">rtmp</span> <span class="n">server</span><span class="p">,</span> <span class="n">rtmp</span> <span class="n">app</span> <span class="n">name</span><span class="p">,</span> <span class="n">rtmp</span> <span class="n">playpath</span><span class="p">)</span>
</pre></div>


<p>Coach video only comes in 1600 quality.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.coach_url', this);">Show source.</a></p>
    <div id="source-nflvid.coach_url" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">coach_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the rtmp URL as a triple for the coach footage of the given</span>
<span class="sd">    game. The elements of the triple are:</span>

<span class="sd">        (rtmp server, rtmp app name, rtmp playpath)</span>

<span class="sd">    Coach video only comes in 1600 quality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">_coach_url</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">season</span><span class="p">(),</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.download_broadcast">
        <p>def <span class="ident">download_broadcast</span>(</p><p>footage_dir, gobj, quality='1600', dry_run=False, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Starts an <code>ffmpeg</code> process to download the full broadcast of the
given game with the quality provided. The qualities available are:
400, 800, 1200, 1600, 2400, 3000, 4500 with 4500 being the best.</p>
<p>The footage will be saved to the following path:</p>
<div class="codehilite"><pre><span class="n">footage_dir</span><span class="o">/</span><span class="p">{</span><span class="n">eid</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">gamekey</span><span class="p">}.</span><span class="n">mp4</span>
</pre></div>


<p>If footage is already at that path, then an
<code>exceptions.LookupError</code> is raised.</p>
<p>A full game's worth of broadcast footage at a quality of 1600 is
about <strong>2GB</strong>.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.download_broadcast', this);">Show source.</a></p>
    <div id="source-nflvid.download_broadcast" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">download_broadcast</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="s">&#39;1600&#39;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts an `ffmpeg` process to download the full broadcast of the</span>
<span class="sd">    given game with the quality provided. The qualities available are:</span>
<span class="sd">    400, 800, 1200, 1600, 2400, 3000, 4500 with 4500 being the best.</span>

<span class="sd">    The footage will be saved to the following path:</span>

<span class="sd">        footage_dir/{eid}-{gamekey}.mp4</span>

<span class="sd">    If footage is already at that path, then an</span>
<span class="sd">    `exceptions.LookupError` is raised.</span>

<span class="sd">    A full game&#39;s worth of broadcast footage at a quality of 1600 is</span>
<span class="sd">    about **2GB**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;Footage path &quot;</span><span class="si">%s</span><span class="s">&quot; already exists.&#39;</span> <span class="o">%</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">broadcast_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>

    <span class="c"># Let&#39;s check to see if the URL exists. We could let ffmpeg catch</span>
    <span class="c"># the error, but since this is a common error, let&#39;s show something</span>
    <span class="c"># nicer than a bunch of ffmpeg vomit.</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_httplib2</span><span class="o">.</span><span class="n">Http</span><span class="p">()</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&#39;HEAD&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;200&#39;</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;BAD URL (http status </span><span class="si">%s</span><span class="s">) for game </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">],</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">),</span> <span class="n">url</span><span class="p">))</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
           <span class="s">&#39;-timeout&#39;</span><span class="p">,</span> <span class="s">&#39;60&#39;</span><span class="p">,</span>
           <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;30&#39;</span><span class="p">]</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-absf&#39;</span><span class="p">,</span> <span class="s">&#39;aac_adtstoasc&#39;</span><span class="p">,</span>  <span class="c"># no idea. ffmpeg says I need it though.</span>
            <span class="s">&#39;-acodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
            <span class="s">&#39;-vcodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
            <span class="n">fp</span><span class="p">,</span>
            <span class="p">]</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Downloading game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.download_coach">
        <p>def <span class="ident">download_coach</span>(</p><p>footage_dir, gobj, dry_run=False, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Starts an <code>rtmpdump</code> process to download the full coach footage of
the given game. Currently, the only quality available is 1600.</p>
<p>The footage will be saved to the following path:</p>
<div class="codehilite"><pre><span class="n">footage_dir</span><span class="o">/</span><span class="p">{</span><span class="n">eid</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">gamekey</span><span class="p">}.</span><span class="n">mp4</span>
</pre></div>


<p>If footage is already at that path, then an
<code>exceptions.LookupError</code> is raised.</p>
<p>A full game's worth of footage at a quality of 1600 is about
<strong>1GB</strong>.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.download_coach', this);">Show source.</a></p>
    <div id="source-nflvid.download_coach" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">download_coach</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts an `rtmpdump` process to download the full coach footage of</span>
<span class="sd">    the given game. Currently, the only quality available is 1600.</span>

<span class="sd">    The footage will be saved to the following path:</span>

<span class="sd">        footage_dir/{eid}-{gamekey}.mp4</span>

<span class="sd">    If footage is already at that path, then an</span>
<span class="sd">    `exceptions.LookupError` is raised.</span>

<span class="sd">    A full game&#39;s worth of footage at a quality of 1600 is about</span>
<span class="sd">    **1GB**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;Footage path &quot;</span><span class="si">%s</span><span class="s">&quot; already exists.&#39;</span> <span class="o">%</span> <span class="n">fp</span><span class="p">)</span>

    <span class="n">server</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">coach_url</span><span class="p">(</span><span class="n">gobj</span><span class="p">)</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;rtmpdump&#39;</span><span class="p">,</span>
           <span class="s">&#39;--rtmp&#39;</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span>
           <span class="s">&#39;--app&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span>
           <span class="s">&#39;--playpath&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
           <span class="s">&#39;--timeout&#39;</span><span class="p">,</span> <span class="s">&#39;60&#39;</span><span class="p">,</span>
           <span class="p">]</span>
    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--stop&#39;</span><span class="p">,</span> <span class="s">&#39;30&#39;</span><span class="p">]</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">fp</span><span class="p">]</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Downloading game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE (incomplete) with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;FAILED to download game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE with game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.footage_full">
        <p>def <span class="ident">footage_full</span>(</p><p>footage_dir, gobj, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns the path to the full video for a given game inside an
nflvid footage directory.</p>
<p>If the full footage doesn't exist, then None is returned.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.footage_full', this);">Show source.</a></p>
    <div id="source-nflvid.footage_full" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">footage_full</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the path to the full video for a given game inside an</span>
<span class="sd">    nflvid footage directory.</span>

<span class="sd">    If the full footage doesn&#39;t exist, then None is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_full_path</span><span class="p">(</span><span class="n">footage_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">fp</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.footage_play">
        <p>def <span class="ident">footage_play</span>(</p><p>footage_play_dir, gobj, playid, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns a file path to an existing play slice in the footage play
directory for the game and play given.</p>
<p>If the file for the play is not readable, then <code>None</code> is returned.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.footage_play', this);">Show source.</a></p>
    <div id="source-nflvid.footage_play" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">footage_play</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">playid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a file path to an existing play slice in the footage play</span>
<span class="sd">    directory for the game and play given.</span>

<span class="sd">    If the file for the play is not readable, then `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamedir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gamedir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">playid</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">fp</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.footage_plays">
        <p>def <span class="ident">footage_plays</span>(</p><p>footage_play_dir, gobj, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns a list of all footage broken down by play inside an nflvid
footage directory. The list is sorted numerically by play id.</p>
<p>If no footage breakdown exists for the game provided, then an empty
list is returned.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.footage_plays', this);">Show source.</a></p>
    <div id="source-nflvid.footage_plays" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">footage_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all footage broken down by play inside an nflvid</span>
<span class="sd">    footage directory. The list is sorted numerically by play id.</span>

<span class="sd">    If no footage breakdown exists for the game provided, then an empty</span>
<span class="sd">    list is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.play">
        <p>def <span class="ident">play</span>(</p><p>gobj, playid, coach=True, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns a <a href="#nflvid.Play"><code>Play</code></a> object given a game and a play id with
timings for the coach footage. If <code>coach</code> is <code>False</code>, then the
timings will be for the broadcast footage.</p>
<p>The game <code>gobj</code> must be an <code>nflgame.game.Game</code> object.</p>
<p>If a play with the given id does not exist, <code>None</code> is returned.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.play', this);">Show source.</a></p>
    <div id="source-nflvid.play" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a `nflvid.Play` object given a game and a play id with</span>
<span class="sd">    timings for the coach footage. If `coach` is `False`, then the</span>
<span class="sd">    timings will be for the broadcast footage.</span>

<span class="sd">    The game `gobj` must be an `nflgame.game.Game` object.</span>

<span class="sd">    If a play with the given id does not exist, `None` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">playid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.plays">
        <p>def <span class="ident">plays</span>(</p><p>gobj, coach=True, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns an ordered dictionary of all plays for a particular game
with timings for the coach footage. If <code>coach</code> is <code>False</code>, then the
timings will be for the broadcast footage.</p>
<p>The game <code>gobj</code> must be an <code>nflgame.game.Game</code> object.</p>
<p>If there is a problem retrieving the data, <code>None</code> is returned.</p>
<p>If the game is over, then the XML data is saved to disk.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.plays', this);">Show source.</a></p>
    <div id="source-nflvid.plays" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an ordered dictionary of all plays for a particular game</span>
<span class="sd">    with timings for the coach footage. If `coach` is `False`, then the</span>
<span class="sd">    timings will be for the broadcast footage.</span>

<span class="sd">    The game `gobj` must be an `nflgame.game.Game` object.</span>

<span class="sd">    If there is a problem retrieving the data, `None` is returned.</span>

<span class="sd">    If the game is over, then the XML data is saved to disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coach</span><span class="p">:</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">__coach_cache</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">__broadcast_cache</span>

    <span class="k">if</span> <span class="n">gobj</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="n">gobj</span><span class="o">.</span><span class="n">eid</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span>

    <span class="n">rawxml</span> <span class="o">=</span> <span class="n">_get_xml_data</span><span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">)</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">_xml_plays</span><span class="p">(</span><span class="n">rawxml</span><span class="p">,</span> <span class="n">coach</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Could not find timing nodes in XML data, &#39;</span>
                <span class="s">&#39;which provide the start time of each play.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">__broadcast_cache</span><span class="p">[</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ps</span>

    <span class="c"># Save the XML data to disk if the game is over.</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">_xmlf</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">gobj</span><span class="o">.</span><span class="n">gamekey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gobj</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">),</span> <span class="n">rawxml</span><span class="p">,</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;Could not cache XML data. Please make &#39;</span>
                    <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; writable.&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ps</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.slice">
        <p>def <span class="ident">slice</span>(</p><p>footage_play_dir, full_footage_file, gobj, coach=True, threads=4, dry_run=False, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Uses <code>ffmpeg</code> to slice the given footage file into play-by-play
pieces.  The <code>full_footage_file</code> should be a path to a full
game downloaded with <code>nflvid-footage</code> and <code>gobj</code> should be the
corresponding <code>nflgame.game.Game</code> object.</p>
<p>The <code>footage_play_dir</code> is where the pieces will be saved:</p>
<div class="codehilite"><pre><span class="p">{</span><span class="n">footage_play_dir</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">eid</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">gamekey</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">playid</span><span class="p">}.</span><span class="n">mp4</span>
</pre></div>


<p>This function will not duplicate work. If a video file exists for
a particular play, then slice will not regenerate it.</p>
<p>Note that this function uses an <code>eventlet</code> green pool to run
multiple <code>ffmpeg</code> instances simultaneously. The maximum number
of threads to use is specified by <code>threads</code>. This function only
terminates when all threads have finished processing.</p>
<p>If <code>coach</code> is <code>False</code>, then play timings for broadcast footage will
be used instead of coach timings.</p>
<p>If <code>dry_run</code> is <code>True</code>, then only the first 10 plays of the game
are sliced.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.slice', this);">Show source.</a></p>
    <div id="source-nflvid.slice" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">threads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses `ffmpeg` to slice the given footage file into play-by-play</span>
<span class="sd">    pieces.  The `full_footage_file` should be a path to a full</span>
<span class="sd">    game downloaded with `nflvid-footage` and `gobj` should be the</span>
<span class="sd">    corresponding `nflgame.game.Game` object.</span>

<span class="sd">    The `footage_play_dir` is where the pieces will be saved:</span>

<span class="sd">        {footage_play_dir}/{eid}-{gamekey}/{playid}.mp4</span>

<span class="sd">    This function will not duplicate work. If a video file exists for</span>
<span class="sd">    a particular play, then slice will not regenerate it.</span>

<span class="sd">    Note that this function uses an `eventlet` green pool to run</span>
<span class="sd">    multiple `ffmpeg` instances simultaneously. The maximum number</span>
<span class="sd">    of threads to use is specified by `threads`. This function only</span>
<span class="sd">    terminates when all threads have finished processing.</span>

<span class="sd">    If `coach` is `False`, then play timings for broadcast footage will</span>
<span class="sd">    be used instead of coach timings.</span>

<span class="sd">    If `dry_run` is `True`, then only the first 10 plays of the game</span>
<span class="sd">    are sliced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

    <span class="n">unsliced</span> <span class="o">=</span> <span class="n">unsliced_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unsliced</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">unsliced</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Only show an annoying error message if there are no sliced</span>
        <span class="c"># plays on disk.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">footage_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">):</span>
            <span class="n">_eprint</span><span class="p">(</span>
                <span class="s">&#39;There are no unsliced plays remaining for game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">.</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;If they have not been sliced yet, then the XML play-by-play &#39;</span>
                <span class="s">&#39;meta data may not be available or is corrupt.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
        <span class="k">return</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">eventlet</span><span class="o">.</span><span class="n">greenpool</span><span class="o">.</span><span class="n">GreenPool</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">unsliced</span><span class="p">:</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">spawn_n</span><span class="p">(</span><span class="n">slice_play</span><span class="p">,</span> <span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span>
                     <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">waitall</span><span class="p">()</span>

    <span class="n">_eprint</span><span class="p">(</span><span class="s">&#39;DONE slicing game </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gobj</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="n">_nice_game</span><span class="p">(</span><span class="n">gobj</span><span class="p">)))</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.slice_play">
        <p>def <span class="ident">slice_play</span>(</p><p>footage_play_dir, full_footage_file, gobj, play, max_duration=0, cut_scoreboard=True, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>This is just like <a href="#nflvid.slice"><code>slice</code></a>, but it only slices the play
provided.  In typical cases, <a href="#nflvid.slice"><code>slice</code></a> should be used since it
makes sure not to duplicate work.</p>
<p>This function will not check if the play-by-play directory for
<code>gobj</code> has been created.</p>
<p><code>max_duration</code> is used to cap the length of a play. This
drastically cuts down on the storage requirements of a game at the
cost of potentially missing longer plays. This is particularly
useful if you are slicing broadcast footage, where imposing a cap
at about 15 seconds can decrease storage requirements by more than
half without missing much.</p>
<p>When <code>cut_scoreboard</code> is <code>True</code>, the first 3.0 seconds of the play
will be clipped to remove the scoreboard view.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.slice_play', this);">Show source.</a></p>
    <div id="source-nflvid.slice_play" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">slice_play</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">play</span><span class="p">,</span>
               <span class="n">max_duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cut_scoreboard</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is just like `nflvid.slice`, but it only slices the play</span>
<span class="sd">    provided.  In typical cases, `nflvid.slice` should be used since it</span>
<span class="sd">    makes sure not to duplicate work.</span>

<span class="sd">    This function will not check if the play-by-play directory for</span>
<span class="sd">    `gobj` has been created.</span>

<span class="sd">    `max_duration` is used to cap the length of a play. This</span>
<span class="sd">    drastically cuts down on the storage requirements of a game at the</span>
<span class="sd">    cost of potentially missing longer plays. This is particularly</span>
<span class="sd">    useful if you are slicing broadcast footage, where imposing a cap</span>
<span class="sd">    at about 15 seconds can decrease storage requirements by more than</span>
<span class="sd">    half without missing much.</span>

<span class="sd">    When `cut_scoreboard` is `True`, the first 3.0 seconds of the play</span>
<span class="sd">    will be clipped to remove the scoreboard view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">start</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="n">play</span><span class="o">.</span><span class="n">idstr</span><span class="p">())</span>

    <span class="n">et</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">end</span>
    <span class="k">if</span> <span class="n">et</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># Probably the last play of the game.</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">et</span><span class="o">.</span><span class="n">seconds</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="o">.</span><span class="n">seconds</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">max_duration</span><span class="p">:</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="n">max_duration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cut_scoreboard</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_seconds</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="n">dr</span> <span class="o">=</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">et</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="o">.</span><span class="n">fractional</span><span class="p">())</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">milli</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">.</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dr</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="n">dr</span><span class="o">.</span><span class="n">milli</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span>
           <span class="s">&#39;-ss&#39;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span>
           <span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span>
           <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">full_footage_file</span><span class="p">,</span>
           <span class="s">&#39;-acodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
           <span class="s">&#39;-vcodec&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span>
           <span class="n">outpath</span><span class="p">,</span>
           <span class="p">]</span>
    <span class="n">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
      
    <div class="item">
      <div class="name def" id="nflvid.unsliced_plays">
        <p>def <span class="ident">unsliced_plays</span>(</p><p>footage_play_dir, gobj, coach=True, dry_run=False, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Scans the game directory inside footage_play_dir and returns a list
of plays that haven't been sliced yet. In particular, a play is
only considered sliced if the following file is readable, assuming
{playid} is its play id:</p>
<div class="codehilite"><pre><span class="p">{</span><span class="n">footage_play_dir</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">eid</span><span class="p">}</span><span class="o">-</span><span class="p">{</span><span class="n">gamekey</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">playid</span><span class="p">}.</span><span class="n">mp4</span>
</pre></div>


<p>All plays for the game given that don't fit this criteria will be
returned in the list.</p>
<p>If the list is empty, then all plays for the game have been sliced.
Alternatively, <code>None</code> can be returned if there was a problem
retrieving the play-by-play meta data.</p>
<p>If <code>coach</code> is <code>False</code>, then play timings for broadcast footage will
be used instead of coach timings.</p>
<p>If <code>dry_run</code> is <code>True</code>, then only the first 10 plays of the game
are sliced.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.unsliced_plays', this);">Show source.</a></p>
    <div id="source-nflvid.unsliced_plays" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">unsliced_plays</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scans the game directory inside footage_play_dir and returns a list</span>
<span class="sd">    of plays that haven&#39;t been sliced yet. In particular, a play is</span>
<span class="sd">    only considered sliced if the following file is readable, assuming</span>
<span class="sd">    {playid} is its play id:</span>

<span class="sd">        {footage_play_dir}/{eid}-{gamekey}/{playid}.mp4</span>

<span class="sd">    All plays for the game given that don&#39;t fit this criteria will be</span>
<span class="sd">    returned in the list.</span>

<span class="sd">    If the list is empty, then all plays for the game have been sliced.</span>
<span class="sd">    Alternatively, `None` can be returned if there was a problem</span>
<span class="sd">    retrieving the play-by-play meta data.</span>

<span class="sd">    If `coach` is `False`, then play timings for broadcast footage will</span>
<span class="sd">    be used instead of coach timings.</span>

<span class="sd">    If `dry_run` is `True`, then only the first 10 plays of the game</span>
<span class="sd">    are sliced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">plays</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">coach</span><span class="p">)</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">_play_path</span><span class="p">(</span><span class="n">footage_play_dir</span><span class="p">,</span> <span class="n">gobj</span><span class="p">)</span>

    <span class="n">unsliced</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">ps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">dry_run</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">idstr</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.mp4&#39;</span> <span class="o">%</span> <span class="n">pid</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="n">unsliced</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unsliced</span>
</pre></div>

    </div>
</div>

    </div>
  

  <h2 id="header-classes">Classes</h2>
      
      <div class="item">
        <p id="nflvid.Play" class="name">class <span class="ident">Play</span></p>
        
  
      <div class="desc"><p>Represents the start and end timings of single play in coach or
broadcast footage.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.Play', this);">Show source.</a></p>
    <div id="source-nflvid.Play" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Play</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the start and end timings of single play in coach or</span>
<span class="sd">    broadcast footage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">playid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Corresponds to the `ArchiveTCIN` or `CATIN` field in the source</span>
<span class="sd">        data. `ArchiveTCIN` is used for broadcast footage while `CATIN`</span>
<span class="sd">        is used for coach footage.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The end time of the play. This is typically the start time of</span>
<span class="sd">        the next play (from `ArchiveTCIN` or `CATIN`). When the next</span>
<span class="sd">        play isn&#39;t available, this is `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A numeric play identifier that serves as a foreign key from an</span>
<span class="sd">        `nflgame.game.Play` object to a `nflvid.Play` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">idstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string play id padded with zeroes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#nflvid.Play">Play</a></li>
                <li>__builtin__.object</li>
              </ul>
              <h4>Instance variables</h4>
                  <div class="item">
                    <p id="nflvid.Play.end" class="name">var <span class="ident">end</span></p>
                    

                    
  
      <div class="desc"><p>The end time of the play. This is typically the start time of
the next play (from <code>ArchiveTCIN</code> or <code>CATIN</code>). When the next
play isn't available, this is <code>None</code>.</p></div>
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="nflvid.Play.playid" class="name">var <span class="ident">playid</span></p>
                    

                    
  
      <div class="desc"><p>A numeric play identifier that serves as a foreign key from an
<code>nflgame.game.Play</code> object to a <a href="#nflvid.Play"><code>Play</code></a> object.</p></div>
    <div class="source_cont">
</div>

                  </div>
                  <div class="item">
                    <p id="nflvid.Play.start" class="name">var <span class="ident">start</span></p>
                    

                    
  
      <div class="desc"><p>Corresponds to the <code>ArchiveTCIN</code> or <code>CATIN</code> field in the source
data. <code>ArchiveTCIN</code> is used for broadcast footage while <code>CATIN</code>
is used for coach footage.</p></div>
    <div class="source_cont">
</div>

                  </div>
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="nflvid.Play.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self, start, end, playid, **keywords)</p>
      </div>
      

      
  
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.Play.__init__', this);">Show source.</a></p>
    <div id="source-nflvid.Play.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">playid</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Corresponds to the `ArchiveTCIN` or `CATIN` field in the source</span>
<span class="sd">    data. `ArchiveTCIN` is used for broadcast footage while `CATIN`</span>
<span class="sd">    is used for coach footage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The end time of the play. This is typically the start time of</span>
<span class="sd">    the next play (from `ArchiveTCIN` or `CATIN`). When the next</span>
<span class="sd">    play isn&#39;t available, this is `None`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A numeric play identifier that serves as a foreign key from an</span>
<span class="sd">    `nflgame.game.Play` object to a `nflvid.Play` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="nflvid.Play.idstr">
        <p>def <span class="ident">idstr</span>(</p><p>self, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns a string play id padded with zeroes.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.Play.idstr', this);">Show source.</a></p>
    <div id="source-nflvid.Play.idstr" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">idstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a string play id padded with zeroes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%04d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playid</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>
      
      <div class="item">
        <p id="nflvid.PlayTime" class="name">class <span class="ident">PlayTime</span></p>
        
  
      <div class="desc"><p>Represents a footage time point retrieved from the source XML
meta data.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.PlayTime', this);">Show source.</a></p>
    <div id="source-nflvid.PlayTime" class="source">
      <div class="codehilite"><pre><span class="k">class</span> <span class="nc">PlayTime</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a footage time point retrieved from the source XML</span>
<span class="sd">    meta data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;hh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The hour portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;mm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The minutes portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;ss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The seconds portion of the play time.&#39;</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s">&#39;milli&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The milliseconds portion of the play time.&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a PlayTime object given a `point` in time in the</span>
<span class="sd">        format `HH:MM:SS:MMM` where `MMM` can be either 2 or 3 digits.</span>

<span class="sd">        Alternatively, `seconds` can be provided (which may be a</span>
<span class="sd">        float).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">milli</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">seconds</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">)))</span>

            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">))</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span>

            <span class="n">seconds</span> <span class="o">-=</span> <span class="n">hh</span> <span class="o">*</span> <span class="mi">3600</span>
            <span class="n">mm</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>

            <span class="n">seconds</span> <span class="o">-=</span> <span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">seconds</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%03d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="n">point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Bad play time format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Expected 4 parts but got </span><span class="si">%d</span><span class="s"> in: </span><span class="si">%s</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">parts</span>

        <span class="c"># I believe milliseconds is given in tens of milliseconds</span>
        <span class="c"># for the ArchiveTCIN node. But the CATIN node (coach timing)</span>
        <span class="c"># provides regular milliseconds.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">*=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">add_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new PlayTime with `seconds` (int or float) added to</span>
<span class="sd">        self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns this time point rounded to the nearest second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">secs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">secs</span>

    <span class="k">def</span> <span class="nf">fractional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns this time point as fractional seconds based on</span>
<span class="sd">        milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">secs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">fractional</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the difference rounded to nearest second between two</span>
<span class="sd">        time points.  The `other` time point must take place before the</span>
<span class="sd">        current time point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not &lt;= than </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">fractional</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span>
</pre></div>

    </div>
</div>


        <div class="class">
              <h4>Ancestors (in MRO)</h4>
              <ul class="class_list">
                <li><a href="#nflvid.PlayTime">PlayTime</a></li>
                <li>__builtin__.object</li>
              </ul>
              <h4>Methods</h4>
                  
    <div class="item">
      <div class="name def" id="nflvid.PlayTime.__init__">
        <p>def <span class="ident">__init__</span>(</p><p>self, point=None, seconds=None, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Construct a PlayTime object given a <code>point</code> in time in the
format <code>HH:MM:SS:MMM</code> where <code>MMM</code> can be either 2 or 3 digits.</p>
<p>Alternatively, <code>seconds</code> can be provided (which may be a
float).</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.PlayTime.__init__', this);">Show source.</a></p>
    <div id="source-nflvid.PlayTime.__init__" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a PlayTime object given a `point` in time in the</span>
<span class="sd">    format `HH:MM:SS:MMM` where `MMM` can be either 2 or 3 digits.</span>
<span class="sd">    Alternatively, `seconds` can be provided (which may be a</span>
<span class="sd">    float).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">milli</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">seconds</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">)))</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="p">))</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">3600</span>
        <span class="n">seconds</span> <span class="o">-=</span> <span class="n">hh</span> <span class="o">*</span> <span class="mi">3600</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">seconds</span> <span class="o">-=</span> <span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%03d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">milli</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__point</span> <span class="o">=</span> <span class="n">point</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">parts</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Bad play time format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;Expected 4 parts but got </span><span class="si">%d</span><span class="s"> in: </span><span class="si">%s</span><span class="s">&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__point</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">=</span> <span class="n">parts</span>
    <span class="c"># I believe milliseconds is given in tens of milliseconds</span>
    <span class="c"># for the ArchiveTCIN node. But the CATIN node (coach timing)</span>
    <span class="c"># provides regular milliseconds.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__coach</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">*=</span> <span class="mi">10</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="nflvid.PlayTime.add_seconds">
        <p>def <span class="ident">add_seconds</span>(</p><p>self, seconds, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns a new PlayTime with <code>seconds</code> (int or float) added to
self.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.PlayTime.add_seconds', this);">Show source.</a></p>
    <div id="source-nflvid.PlayTime.add_seconds" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new PlayTime with `seconds` (int or float) added to</span>
<span class="sd">    self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PlayTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fractional</span><span class="p">()</span> <span class="o">+</span> <span class="n">seconds</span><span class="p">)</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="nflvid.PlayTime.fractional">
        <p>def <span class="ident">fractional</span>(</p><p>self, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns this time point as fractional seconds based on
milliseconds.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.PlayTime.fractional', this);">Show source.</a></p>
    <div id="source-nflvid.PlayTime.fractional" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">fractional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns this time point as fractional seconds based on</span>
<span class="sd">    milliseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">secs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
</pre></div>

    </div>
</div>

    </div>
  
                  
    <div class="item">
      <div class="name def" id="nflvid.PlayTime.seconds">
        <p>def <span class="ident">seconds</span>(</p><p>self, **keywords)</p>
      </div>
      

      
  
      <div class="desc"><p>Returns this time point rounded to the nearest second.</p></div>
    <div class="source_cont">
    <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflvid.PlayTime.seconds', this);">Show source.</a></p>
    <div id="source-nflvid.PlayTime.seconds" class="source">
      <div class="codehilite"><pre><span class="k">def</span> <span class="nf">seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns this time point rounded to the nearest second.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hh</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">milli</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">secs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">secs</span>
</pre></div>

    </div>
</div>

    </div>
  
        </div>
      </div>



<hr>
<p style="text-align: right;">
  Documentation generated by
  <code><a href="https://github.com/BurntSushi/pdoc">pdoc</a></code>
  0.1.4.

  pdoc is in the public domain with the
  <a href="http://unlicense.org">UNLICENSE</a>.
</p>
</div>
</body>
</html>
